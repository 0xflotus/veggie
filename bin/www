#!/usr/bin/env node

const meow = require('meow');
const cli = meow(`
      Usage
        $ mock-server -d <mocks glob> -p <port>

      Options
        -g, --glob  Glob matching files containing mock services
        -p, --port  Port to serve mocks from
        -d, --delay  Max delay to wait before returning service response
        -v, --version  Output mock-server version and exit

      Examples
        $ mock-server -d services -p 9999
        serving mock data from localhost:9999
  `, {
    string: 'dir',
    number: [ 'port', 'delay' ],
    default: {
      dir: process.cwd(),
      port: 1337,
      delay: 1000
    },
    alias: {
      d: 'dir',
      p: 'port',
      v: 'version'
    }
  })

const { port, glob, delay } = cli.flags
const app = require('express')()

const serve = require('../src').serve
serve({ app, glob, delay })

app.listen(port, function() {
  console.log(`serving mock data from localhost:${port}`)
})
